# 自動化スクリプトについて

## 処理の流れ

アプリ`CE_ImgSaver`の動作は、基本的に

 * 多数(数百~数千)のユーザタイムラインを探索し、メディアツイートを収集
 * 収集した画像ツイート内の画像をローカルの大規模ストレージに保存

のようになっています。これらの処理は主に`Saver.py`および`Clawler.py`によって行われます。  

## 自動化の際のヒント

これらの動作を完全に自動化するには、以下の点に注意する必要があります。  

 * 不定期な対象ユーザの追加、それに伴うレコードの初期化
 * 画像保存ループの適切なペース
 * API制限

画像を保存するよりも先にユーザDB内のすべてのレコードが正しい値を持っている必要があり、  
新規ツイート探索より先に追加ユーザのレコード初期化を行う必要があるので、フローとしては以下のようになります。  

 * DBに追加ユーザが
    * 存在→ 全ての新規追加ユーザのレコードを初期化
    * 存在しない→ 最終クロール日時が最も遠いユーザのTLを(API制限ギリギリまで)探索し、userTableおよびimageTableを更新
 * imageTableを読んで画像を保存

このフロー設計では、画像保存まで到達するのに膨大な時間が必要になってしまいます。
画像保存フローはDB更新と並行処理できる可能性もありますが、pbs.twimg.comのAPI制限ルールが不明なため推奨はされません。  